% LMU Exam Package
% Note: xcolor, amsmath, amssymb are already loaded by Quarto
\usepackage{fancyhdr}
\usepackage{lastpage}
\usepackage{tikz}
\usepackage[most]{tcolorbox}

%% Solution box style - dark gray left border
\newtcolorbox{solutionbox}{
  blanker,
  left=4mm,
  borderline west={3pt}{0pt}{gray!50},
  before skip=0.5\baselineskip,
  after skip=0.5\baselineskip,
  boxsep=2mm,
  arc=0pt,
  outer arc=0pt,
  top=2mm,
  bottom=2mm,
  right=2mm,
}

%% Solution mode toggle - defined and set by Lua filter in header-includes
%% \ifsolution is defined by the filter before this file is included

%% Metadata commands - defined by Lua filter (providecommand as fallback)
\providecommand{\examsemester}{}
\providecommand{\examveranstaltung}{}
\providecommand{\examveranstaltungkurz}{}
\providecommand{\examdozent}{}
\providecommand{\examdatum}{}
\providecommand{\examdauer}{}
\providecommand{\anzahlaufgaben}{0}
\providecommand{\gesamtpunkte}{0}

%% Points command - displays points in parentheses
\newcommand{\punkte}[1]{\hfill\textbf{(#1 Punkte)}}

%% Point markers for grading - only visible in solution mode
%% \p = 1 point, \hp = 0.5 points (half), \pp = 2 points (double)
%% These work both in text mode and math mode
\newcommand{\pmark}[1]{\ifsolution\ifmmode\text{\textsuperscript{\textcolor{red}{\tiny[#1]}}}\else\textsuperscript{\textcolor{red}{\tiny[#1]}}\fi\fi}
\newcommand{\p}{\pmark{1P}}
\newcommand{\hp}{\pmark{½P}}
\newcommand{\pp}{\pmark{2P}}

%% Answer field with 5mm grid (only shown when solution=false)
%% Uses breakable tcolorbox so it can continue onto next page
%% Usage: \antwortfeld{height in cm}, e.g., \antwortfeld{4}
\newcommand{\antwortfeld}[1]{%
  \ifsolution
    \vspace{0.5\baselineskip}% minimal space in solution mode
  \else
    \par\vspace{0.3\baselineskip}%
    \begin{tcolorbox}[
      breakable,
      enhanced,
      colback=white,
      colframe=gray!60,
      boxrule=0.4pt,
      arc=0pt,
      outer arc=0pt,
      left=0pt, right=0pt, top=0pt, bottom=0pt,
      boxsep=0pt,
      underlay={
        \begin{tcbclipinterior}
          \draw[step=5mm, gray!40, thin] (interior.south west) grid (interior.north east);
        \end{tcbclipinterior}
      },
    ]
    \vspace*{#1 cm}
    \end{tcolorbox}%
    \par\vspace{0.3\baselineskip}%
  \fi
}

%% Points table - defined by Lua filter (providecommand as fallback)
\providecommand{\punktetabelle}{%
\begin{tabular}{|l|c|c|}
  \hline
  & mögliche Punkte & erreichte Punkte \\
  \hline
  \hline
  \textit{(Keine Punkte definiert)} & & \\
  \hline
  \textbf{Summe} & & \\
  \hline
\end{tabular}%
}

%% Header and footer
\pagestyle{fancy}
\fancyhf{}
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0.4pt}
\fancyhead[L]{\small Klausur \examsemester{} --- \examveranstaltungkurz}
\fancyhead[R]{\small Name: \rule{4cm}{0.4pt}}
\fancyfoot[R]{Seite \thepage{} von \pageref{LastPage}}
